# 🚀 次のステップ - Stripe決済を動作させる

## ⚠️ 重要: 現在の状態

現在、`.env`ファイルに**本番用の公開キー**が設定されていますが、**シークレットキーが未設定**です。
決済を動作させるには、以下の手順を**必ず実施**してください。

---

## 📝 即座に実行すべき手順

### ステップ1: Stripeシークレットキーを取得

1. [Stripeダッシュボード](https://dashboard.stripe.com/test/apikeys)を開く
2. **テストモード**に切り替える（開発用）
3. **シークレットキー**をクリックして表示
4. `sk_test_`で始まるキーをコピー

### ステップ2: .envファイルを更新

`project/.env`ファイルを開いて、以下の行を編集：

```env
# この行を探す：
STRIPE_SECRET_KEY=sk_test_REPLACE_WITH_YOUR_SECRET_KEY

# 実際のシークレットキーに置き換える：
STRIPE_SECRET_KEY=sk_test_あなたの実際のシークレットキー
```

**重要**: 
- ✅ `sk_test_`で始まるキー = テストモード（開発用）
- ❌ `pk_live_`で始まるキー = これは公開キーなので使用不可

### ステップ3: 開発サーバーを起動

```bash
cd project
npm run dev:vercel
```

### ステップ4: 動作確認

1. ブラウザで http://localhost:3000/donations を開く
2. 「寄付する」ボタンをクリック
3. Stripe Checkoutページが表示されることを確認

### ステップ5: テスト決済

Checkoutページで以下のテストカード情報を使用：

```
カード番号: 4242 4242 4242 4242
有効期限: 12/34
CVC: 123
郵便番号: 任意
```

---

## 🔧 開発環境と本番環境の使い分け

### 開発環境（ローカル）

```env
# テストモードのキーを使用
VITE_STRIPE_PUBLISHABLE_KEY=pk_test_...
STRIPE_SECRET_KEY=sk_test_...
```

- テストカードで決済可能
- 実際の請求は発生しない
- Stripeダッシュボードのテストモードで確認

### 本番環境（Vercel）

```env
# 本番モードのキーを使用
VITE_STRIPE_PUBLISHABLE_KEY=pk_live_...
STRIPE_SECRET_KEY=sk_live_...
```

- 実際のカードで決済
- 実際の請求が発生
- Stripeダッシュボードの本番モードで確認

---

## 📚 詳細ガイド

さらに詳しい情報は以下のドキュメントを参照：

1. **クイックスタート**: `QUICKSTART_STRIPE.md`
   - 5分で始める簡単ガイド
   - すぐに動作させたい場合はこれを読む

2. **詳細設定**: `README_STRIPE.md`
   - 完全な設定手順
   - トラブルシューティング
   - 本番環境への移行方法

3. **デプロイメント**: `../DEPLOYMENT_CHECKLIST.md`
   - Vercelデプロイ前のチェックリスト
   - 本番環境の設定方法

---

## ✅ 現在の設定状態

### 完了済み
- ✅ Vite設定（APIプロキシ）
- ✅ Vercel設定ファイル
- ✅ パッケージのインストール
- ✅ APIエンドポイントの実装
- ✅ 環境変数チェック機能
- ✅ `.gitignore`設定

### 未完了（あなたが実施すべきこと）
- ⏳ Stripeシークレットキーの設定
- ⏳ 開発サーバーでの動作確認
- ⏳ テスト決済の実施
- ⏳ 本番環境用のキー取得
- ⏳ Vercelへのデプロイ

---

## 🆘 トラブルが発生した場合

### エラー: "STRIPE_SECRET_KEY must start with 'sk_'"

**原因**: 公開キー（pk_）をシークレットキーに設定している

**解決策**: `.env`の`STRIPE_SECRET_KEY`を`sk_test_`で始まるキーに変更

### エラー: "決済ページの表示に失敗しました"

**原因**: APIサーバーが起動していない

**解決策**: 
```bash
# 必ずこのコマンドで起動
npm run dev:vercel

# 通常のnpm run devではAPIが動作しません
```

### ボタンを押しても何も起こらない

**原因**: 環境変数が読み込まれていない

**解決策**:
1. `.env`ファイルを保存
2. サーバーを再起動（Ctrl+C → `npm run dev:vercel`）
3. ブラウザをハードリロード（Ctrl+Shift+R）

---

## 🎯 推奨される作業順序

1. **今すぐ**: Stripeシークレットキーを設定
2. **5分後**: 開発サーバーで動作確認
3. **10分後**: テスト決済を実施
4. **準備できたら**: Vercelにデプロイ
5. **本番移行前**: 本番用のキーとWebhookを設定

---

## 📞 サポート

わからないことがあれば：
1. まず`QUICKSTART_STRIPE.md`を読む
2. 次に`README_STRIPE.md`のトラブルシューティングを確認
3. それでも解決しない場合は、プロジェクト管理者に連絡

---

**すぐに始めるには**: 上記の「ステップ1」から順番に実施してください！

